# Checkpoint 4 Improvement Plan (Minimal Structural)

Date: 2026-02-20  
Inputs:
- `docs/testing/results/archive/retest-issue-matrix-2026-02-20-checkpoint2.md`
- `docs/testing/results/archive/retest-root-cause-map-2026-02-20-checkpoint3.md`

Principle: Bitter Lesson style. Prioritize structure, gating, and measurement. Avoid adding domain payload.

## Objective

Close confirmed infrastructure/contract risks now, then retest to resolve behavior hypotheses with authoritative evidence.

## Plan Overview

### Track A: Must-Fix Before Next Rerun (structural, high leverage)

1. Add deterministic `Saved:` contract checks in harness outputs.
- Targets: `I-05`, `I-06`, `I-07`, `I-14`
- Files:
  - `dev/testing/scripts/retest-runner.ps1`
  - matrix template/report files in `dev/testing/results/`
- Change:
  - After each turn, write `saved-contract-<turn>.txt`:
    - `PASS` if final line exactly matches `Saved: <...>` or `Saved: none - <reason>`.
    - `FAIL` otherwise.
  - Include this artifact in retest matrices.
- Acceptance:
  - Every turn has explicit contract status artifact.
  - No matrix row infers contract correctness from narrative text alone.

2. Preserve and formalize failure-path write detection.
- Targets: `I-02`
- Files:
  - `dev/testing/scripts/retest-runner.ps1` (already partially implemented)
- Change:
  - Keep auto failure snapshot+diff behavior.
  - Ensure failure diff naming is predictable and documented in harness.
- Acceptance:
  - Any non-zero turn has `snap-failure-*` and `diff-*-failure.txt`.
  - Interrupted run analysis always includes whether writes occurred.

3. Normalize preview path convention.
- Targets: `I-10`
- Files:
  - `skills/landscape-design/SKILL.md`
  - `dev/testing/regression-harness.md`
- Change:
  - Specify previews must be under `areas/` as:
    - `areas/{area-name}-option-a.svg`, `areas/{area-name}-option-b.svg`
  - Keep canonical path unchanged:
    - `areas/{area-name}-layout.svg` (linked from area file).
- Acceptance:
  - Future diffs show preview files under `areas/` only.
  - Matrix checks no longer need dual-path interpretation.

4. Require deterministic open-target evidence per design scenario.
- Targets: `I-04`, `I-11`, `I-12`
- Files:
  - `dev/testing/regression-harness.md`
  - matrix outputs in `dev/testing/results/`
- Change:
  - Add a required `open-evidence-<scenario>.md` entry format:
    - file path opened,
    - app observed,
    - timestamp,
    - screenshot reference or note.
  - `open_target_verified` cannot be `PASS` without this artifact.
- Acceptance:
  - Scenarios 3/4/5 each include direct open-evidence artifact.
  - Process snapshots remain supporting evidence, not primary proof.

5. Add explicit run gate block to every matrix.
- Targets: `I-14`
- Files:
  - matrix docs under `dev/testing/results/`
- Change:
  - Add top block with:
    - `GO/NO-GO`,
    - blocker list,
    - counts by status (`PASS/FAIL/INCONCLUSIVE/INCOMPLETE`).
- Acceptance:
  - Operator can decide proceed/stop without manual row-by-row synthesis.

6. Normalize text encoding for report outputs.
- Targets: `I-13`
- Files:
  - `dev/testing/scripts/retest-runner.ps1`
  - result file writing commands
- Change:
  - Set UTF-8 encoding explicitly where harness writes text artifacts.
- Acceptance:
  - Interruption lines render without `Ã‚Â·` artifacts in new result files.

## Track A Implementation Status (2026-02-20)

Implemented:
1. Deterministic `Saved:` artifacts in runner (`saved-contract-turn*.txt`).
2. Failure-path snapshot/diff capture with predictable naming retained.
3. Preview/canonical `areas/` path convention normalized in:
- `skills/landscape-design/SKILL.md`
- `dev/testing/regression-harness.md`
4. Deterministic open-evidence requirement formalized:
- `open-evidence.md` stubs generated by runner for scenarios 3/4/5,
- harness requires direct user-observed proof.
5. Matrix gate-block standardization:
- existing partial/targeted matrices updated,
- reusable template added in `docs/testing/results/active/retest-matrix-template.md`.
6. UTF-8 defaults enabled in runner output writing.

Remaining from this checkpoint:
- Track B items are intentionally deferred until authoritative rerun evidence exists.

### Track B: Defer Until Authoritative Rerun Data

1. Scenario2 citation compliance and persistence mismatch.
- Targets: `I-05`, `I-08`
- Decision: do not edit skill logic yet; verify in post-fix rerun first.

2. Scenario3/5 approval-save mismatch hypothesis.
- Targets: `I-06`, `I-07`
- Decision: rerun first with improved instrumentation, then decide skill edits.

3. Scenario4 modification-targeting hypothesis.
- Targets: `I-09`
- Decision: rerun first; patch skill only if failure persists.

## Execution Order

1. Implement Track A changes.
2. Re-baseline docs/matrix template.
3. Run targeted rerun (`v7`) after usage reset.
4. Produce authoritative targeted matrix.
5. If targeted gate passes, run full harness.
6. Apply Track B skill changes only if rerun confirms those failures.

## Why This Fits Bitter Lesson

- We improve observability and control surfaces first.
- We avoid brittle prompt overfitting based on contaminated/incomplete runs.
- We reserve behavior-level edits for confirmed failures only.

